{% extends "base.html" %}

{% block title %}查詢門診班表{% endblock %}

{% block content %}
<h1>查詢門診班表</h1>
<form method="get" class="filter-bar">
  <div class="field">
    {{ form.date.label_tag }}
    {{ form.date }}
  </div>
  <div class="field">
    {{ form.department.label_tag }}
    {{ form.department }}
  </div>
  <div class="field-actions">
    <button type="submit" class="secondary btn-compact">查詢</button>
    {% if request.GET %}
      <a href="{% url 'patients:schedule-search' %}" role="button" class="secondary btn-compact">清除</a>
    {% endif %}
  </div>
</form>

<table>
  <thead>
    <tr>
      <th>日期</th>
      <th>時段</th>
      <th>科別</th>
      <th>醫師</th>
      <th>剩餘名額</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for schedule in schedules %}
      <tr>
        <td>{{ schedule.date }}</td>
        <td>{{ schedule.get_session_display }}</td>
        <td>{{ schedule.doctor.department.name }}</td>
        <td><a href="{% url 'patients:doctor-detail' schedule.doctor.pk %}">{{ schedule.doctor.user.display_name }}</a></td>
        <td>
          {{ schedule.remaining_quota }}/{{ schedule.quota }}
          {% if schedule.remaining_quota > 0 and schedule.status == 'open' %}
            <span class="badge badge-success">可預約</span>
          {% else %}
            <span class="badge badge-muted">額滿</span>
          {% endif %}
        </td>
        <td class="actions">
          <div class="button-set">
            {% if schedule.remaining_quota > 0 and schedule.status == 'open' %}
              <a href="{% url 'patients:appointment-book' schedule.pk %}" role="button" class="btn-compact">預約</a>
            {% else %}
              <span class="badge badge-muted">無法預約</span>
            {% endif %}
          </div>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="6">目前查詢沒有結果。</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
