{% extends "base.html" %}

{% block title %}掛號紀錄{% endblock %}

{% block content %}
<h1>掛號紀錄</h1>
<p class="help-text">掌握即將到來與歷史掛號，可隨時查看看診進度或取消預約。</p>
<table>
  <thead>
    <tr>
      <th>日期 / 時段</th>
      <th>醫師 / 科別</th>
      <th>就診對象</th>
      <th>號碼</th>
      <th>狀態</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for appointment in appointments %}
      <tr>
        <td>{{ appointment.schedule.date }} {{ appointment.schedule.get_session_display }}</td>
        <td>{{ appointment.schedule.doctor.user.display_name }}（{{ appointment.schedule.doctor.department.name }}）</td>
        <td>
          {% if appointment.family_member %}
            {{ appointment.family_member.full_name }}
          {% else %}
            本人
          {% endif %}
        </td>
        <td>{{ appointment.queue_number }}</td>
        <td>
          {% if appointment.status == 'reserved' %}
            <span class="badge badge-warning">{{ appointment.get_status_display }}</span>
          {% elif appointment.status == 'checked_in' %}
            <span class="badge badge-success">{{ appointment.get_status_display }}</span>
          {% elif appointment.status == 'in_progress' %}
            <span class="badge">{{ appointment.get_status_display }}</span>
          {% elif appointment.status == 'completed' %}
            <span class="badge badge-success">{{ appointment.get_status_display }}</span>
          {% elif appointment.status == 'cancelled' %}
            <span class="badge badge-muted">{{ appointment.get_status_display }}</span>
          {% else %}
            <span class="badge badge-muted">{{ appointment.get_status_display }}</span>
          {% endif %}
        </td>
        <td class="actions">
          <div class="button-set">
            <a href="{% url 'patients:appointment-progress' appointment.pk %}" role="button" class="btn-compact">看診進度</a>
          {% if appointment.status == 'reserved' %}
            <form method="post" action="{% url 'patients:appointment-cancel' appointment.pk %}">
              {% csrf_token %}
              <button type="submit" class="secondary btn-compact">取消</button>
            </form>
          {% endif %}
          </div>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="6">目前沒有掛號紀錄。</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
