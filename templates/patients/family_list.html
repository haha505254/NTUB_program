{% extends "base.html" %}

{% block title %}家屬管理{% endblock %}

{% block content %}
<h1>家屬管理</h1>
<div class="button-set page-actions">
  <a href="{% url 'patients:family-add' %}" role="button" class="btn-compact">新增家屬</a>
  <a href="{% url 'patients:dashboard' %}" role="button" class="secondary btn-compact">返回儀表板</a>
</div>
{% if has_incomplete_family %}
  <p class="help-text">⚠️ 有家屬資料尚未填寫完整，掛號前請點「編輯」補齊身分證/護照、生日與聯絡電話。</p>
{% endif %}
<table>
  <thead>
    <tr>
      <th>姓名</th>
      <th>關係</th>
      <th>身分證/護照</th>
      <th>生日</th>
      <th>聯絡電話</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for member in family_members %}
      <tr>
        <td>{{ member.full_name }}</td>
        <td>{{ member.relationship }}</td>
        <td>
          {{ member.national_id|default:"-" }}
          {% if not member.national_id %}
            <span class="badge badge-danger">需補齊</span>
          {% endif %}
        </td>
        <td>
          {{ member.birth_date|date:"Y-m-d"|default:"-" }}
          {% if not member.birth_date %}
            <span class="badge badge-danger">需補齊</span>
          {% endif %}
        </td>
        <td>
          {{ member.phone|default:"-" }}
          {% if not member.phone %}
            <span class="badge badge-danger">需補齊</span>
          {% endif %}
        </td>
        <td class="actions">
          <div class="button-set">
            <a href="{% url 'patients:family-edit' member.pk %}" role="button" class="secondary btn-compact">編輯</a>
            <form method="post" action="{% url 'patients:family-delete' member.pk %}">
              {% csrf_token %}
              <button type="submit" class="secondary btn-compact" onclick="return confirm('確定刪除？');">刪除</button>
            </form>
          </div>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="6">尚未新增家屬資料。</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
