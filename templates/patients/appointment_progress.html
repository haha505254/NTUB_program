{% extends "base.html" %}

{% block title %}看診進度{% endblock %}

{% block content %}
<h1>看診進度</h1>
<div class="card-grid">
  <section class="card">
    <h2>您的掛號</h2>
    <ul>
      <li>日期：{{ schedule.date }} {{ schedule.get_session_display }}</li>
      <li>科別：{{ schedule.doctor.department.name }}</li>
      <li>醫師：{{ schedule.doctor.user.display_name }}</li>
      <li>您的號碼：{{ appointment.queue_number }}</li>
      <li>目前狀態：
        {% if appointment.status == 'reserved' %}
          <span class="badge badge-warning">{{ appointment.get_status_display }}</span>
        {% elif appointment.status == 'checked_in' %}
          <span class="badge badge-success">{{ appointment.get_status_display }}</span>
        {% elif appointment.status == 'in_progress' %}
          <span class="badge">{{ appointment.get_status_display }}</span>
        {% elif appointment.status == 'completed' %}
          <span class="badge badge-success">{{ appointment.get_status_display }}</span>
        {% elif appointment.status == 'cancelled' %}
          <span class="badge badge-muted">{{ appointment.get_status_display }}</span>
        {% else %}
          <span class="badge badge-muted">{{ appointment.get_status_display }}</span>
        {% endif %}
      </li>
    </ul>
  </section>

  <section class="card">
    <h2>門診狀態</h2>
    <ul>
      <li>目前看診號碼：{% if current_number %}{{ current_number }}{% else %}尚未叫號{% endif %}</li>
      <li>已報到人數：{{ checked_in_count }}</li>
      <li>等待人數：{{ waiting_count }}</li>
      <li>已完成：{{ completed_count }}</li>
    </ul>
  </section>
</div>

<section class="card">
  <h2>最新事件</h2>
  <ul>
    {% for event in events %}
      <li>
        {{ event.created_at|date:"m/d H:i" }} - {{ event.get_event_display }}（號碼 {{ event.appointment.queue_number }}）
        {% if event.actor %} — 由 {{ event.actor.get_username }}{% endif %}
      </li>
    {% empty %}
      <li>尚無事件紀錄。</li>
    {% endfor %}
  </ul>
</section>

<div class="button-set page-actions">
  <a href="{% url 'patients:appointments' %}" role="button" class="secondary btn-compact">返回掛號紀錄</a>
</div>
{% endblock %}
