{% extends "administration/base.html" %}

{% block admin_page_title %}醫師管理{% endblock %}

{% block admin_content %}
<div class="page-header">
  <div>
    <h1>醫師管理</h1>
    <p class="help-text">維護醫師帳號、職稱與啟用狀態。</p>
  </div>
  <div class="actions">
    <a href="{% url 'administration:doctors-add' %}" role="button" class="btn-compact">新增醫師</a>
  </div>
</div>

<form method="get" class="filter-bar">
  <div class="field">
    <label for="doctor-search">搜尋關鍵字</label>
    <input type="search" id="doctor-search" name="q" placeholder="姓名、帳號或證書號" value="{{ search_query }}">
  </div>
  <div class="field">
    <label for="doctor-department">科別</label>
    <select id="doctor-department" name="department">
      <option value="">全部科別</option>
      {% for department in departments %}
        <option value="{{ department.pk }}" {% if department_filter|stringformat:"s" == department.pk|stringformat:"s" %}selected{% endif %}>
          {{ department.name }}
        </option>
      {% endfor %}
    </select>
  </div>
  <div class="field">
    <label for="doctor-status">狀態</label>
    <select id="doctor-status" name="status">
      <option value="all" {% if status_filter == "all" %}selected{% endif %}>全部</option>
      <option value="active" {% if status_filter == "active" %}selected{% endif %}>啟用</option>
      <option value="inactive" {% if status_filter == "inactive" %}selected{% endif %}>停用</option>
    </select>
  </div>
  <div class="field-actions">
    <button type="submit" class="secondary btn-compact">套用條件</button>
    <a href="{% url 'administration:doctors' %}" role="button" class="secondary btn-compact">清除</a>
  </div>
</form>

<table>
  <thead>
    <tr>
      <th>姓名</th>
      <th>帳號</th>
      <th>科別</th>
      <th>證書號</th>
      <th>狀態</th>
      <th>最後更新</th>
      <th style="width: 220px;">操作</th>
    </tr>
  </thead>
  <tbody>
    {% for doctor in doctors %}
      <tr>
        <td>{{ doctor.user.display_name }}</td>
        <td>{{ doctor.user.username }}</td>
        <td>{{ doctor.department.name }}</td>
        <td>{{ doctor.license_number }}</td>
        <td>
          {% if doctor.is_active %}
            <span class="badge">啟用</span>
          {% else %}
            <span class="badge badge-muted">停用</span>
          {% endif %}
        </td>
        <td>{{ doctor.updated_at|date:"Y-m-d H:i" }}</td>
        <td class="actions">
          <div class="button-set">
            <a href="{% url 'administration:doctors-edit' doctor.pk %}" class="secondary btn-compact" role="button">編輯</a>
            <form method="post" action="{% url 'administration:doctors-toggle' doctor.pk %}">
              {% csrf_token %}
              {% if doctor.is_active %}
                <button type="submit" class="secondary btn-compact">停用</button>
              {% else %}
                <button type="submit" class="btn-compact">啟用</button>
              {% endif %}
            </form>
          </div>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="7">尚未建立醫師資料。</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
