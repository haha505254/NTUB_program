{% extends "administration/base.html" %}

{% block admin_page_title %}科別管理{% endblock %}

{% block admin_content %}
<div class="page-header">
  <div>
    <h1>科別管理</h1>
    <p class="help-text">停用的科別不會出現在掛號查詢與班表設定中。</p>
  </div>
  <div class="actions">
    <a href="{% url 'administration:departments-add' %}" role="button" class="btn-compact">新增科別</a>
  </div>
</div>

<form method="get" class="filter-bar">
  <div class="field">
    <label for="q">搜尋關鍵字</label>
    <input type="search" id="q" name="q" placeholder="搜尋名稱或代碼" value="{{ search_query }}" aria-label="搜尋科別">
  </div>
  <div class="field-actions">
    <button type="submit" class="secondary btn-compact">搜尋</button>
    {% if search_query %}
      <a href="{% url 'administration:departments' %}" role="button" class="secondary btn-compact">清除</a>
    {% endif %}
  </div>
</form>

<table>
  <thead>
    <tr>
      <th>代碼</th>
      <th>名稱</th>
      <th>狀態</th>
      <th>最後更新時間</th>
      <th style="width: 180px;">操作</th>
    </tr>
  </thead>
  <tbody>
    {% for department in departments %}
      <tr>
        <td>{{ department.code }}</td>
        <td>{{ department.name }}</td>
        <td>
          {% if department.is_active %}
            <span class="badge">啟用</span>
          {% else %}
            <span class="badge badge-muted">停用</span>
          {% endif %}
        </td>
        <td>{{ department.updated_at|date:"Y-m-d H:i" }}</td>
        <td class="actions">
          <div class="button-set">
            <a href="{% url 'administration:departments-edit' department.pk %}" class="secondary btn-compact" role="button">編輯</a>
            <form method="post" action="{% url 'administration:departments-toggle' department.pk %}">
              {% csrf_token %}
              {% if department.is_active %}
                <button type="submit" class="secondary btn-compact">停用</button>
              {% else %}
                <button type="submit" class="btn-compact">啟用</button>
              {% endif %}
            </form>
          </div>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="5">尚未建立任何科別。</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
